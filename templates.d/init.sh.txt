#!/bin/sh
# eotk (c) 2017 Alec Muffett

# we'll factor these out in case of manual editing, although moving
# configured projects around the filesystem will be challenging;
# easier instead to configure in-situ and as the intended user.

EOTK_HOME=%EOTK_HOME%
EOTK_USER=%USER%
EOTK_STARTUP_LOG=/tmp/eotk-startup.log

# does it exist?

[ -d "$EOTK_HOME" ] || exit 0

cd $EOTK_HOME || exit 1

# eotk wrapper

run_eotk() {
    su $EOTK_USER -c "exec $EOTK_HOME/eotk $*"
    return $?
}

# log_message: you might want to wire this into syslog, etc...

log_message() {
    echo "$@" 1>&2
}

# basics

has_softmap=true
softmap_projects="wiki"

case "$1" in
    start)
        log_message starting EOTK
	run_eotk start -a || exit 1
	if $has_softmap ; then
            run_eotk ob-start $softmap_projects || exit 1
        fi
	;;

    restart)
        log_message restarting EOTK
	run_eotk restart -a || exit 1
	if $has_softmap ; then
            run_eotk ob-restart $softmap_projects || exit 1
        fi
	;;

    stop)
        log_message stopping EOTK
	run_eotk shutdown
	;;

    *)
	echo "Usage: $0 {start|stop|restart}"
	exit 1
	;;
esac

# done

exit 0
